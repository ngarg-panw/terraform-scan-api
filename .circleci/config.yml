version: 2.1
description: 'Test orb for prisma scan orb'

orbs:
  scan: panw-ns/prisma-cloud@dev:first

jobs:
  scan-image: scan/prisma-cloud
  docker-build-and-save:
    executor: twistcli/default
    steps:
      - checkout
      - run: 'docker build -t myrepo/myimage:tag .'
      - run: mkdir -p workspace
      - run: 'docker save myrepo/myimage:tag -o workspace/image.tar'
      - persist_to_workspace:
          root: workspace
          paths:
            - image.tar


workflows:  
  scan:
    jobs:
      - scan-image:
          access-key: 833a6c35-d23d-4a07-958b-69aabb1d0d51
          secret-key: PC_SECRET_KEY 
          prisma-cloud-api-url: https://api.prismacloud.io
          #directory_path: ./demo/eks.tf.json
      #- scan_image/twistlock_job:
          #tl_user: test
          #tl_pass: "test@123"
          #tl_console_url: http://18.217.116.33:8081 
